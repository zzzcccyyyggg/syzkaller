BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
var addr ffff88810c369300, addr masked 88810c369300
Kernel panic: ============ DATARACE ============
VarName 2870364362311847012, BlockLineNumber 9, IrLineNumber 1, is write 0
Function: found_watchpoint kernel/kccwf/wp_checker.c:298 [inline]
Function: watchpoints_monitor+0x13cd/0x1a10 kernel/kccwf/wp_checker.c:406
Function: handle_monitor_mode+0xca/0xf0 kernel/kccwf/core.c:193
Function: kccwf_rec_mem_access+0x391/0x410 kernel/kccwf/core.c:530
Function: btrfs_get_root_last_trans fs/btrfs/ctree.h:369 [inline]
Function: btrfs_record_root_in_trans+0x228/0x4b0 fs/btrfs/transaction.c:499
Function: start_transaction+0x8dc/0x38a0 fs/btrfs/transaction.c:779
Function: btrfs_start_transaction+0x49/0x70 fs/btrfs/transaction.c:816
Function: btrfs_truncate fs/btrfs/inode.c:7662 [inline]
Function: btrfs_setsize fs/btrfs/inode.c:5257 [inline]
Function: btrfs_setattr+0x11f5/0x2ae0 fs/btrfs/inode.c:5292
Function: notify_change+0xb2e/0xe30 fs/attr.c:552
Function: do_truncate+0x1a4/0x220 fs/open.c:68
Function: handle_truncate fs/namei.c:3508 [inline]
Function: do_open fs/namei.c:3891 [inline]
Function: path_openat+0x3043/0x37d0 fs/namei.c:4046
Function: do_filp_open+0x1fd/0x470 fs/namei.c:4073
Function: do_sys_openat2+0x121/0x1c0 fs/open.c:1437
Function: do_sys_open fs/open.c:1452 [inline]
Function: __do_sys_open fs/open.c:1460 [inline]
Function: __se_sys_open fs/open.c:1456 [inline]
Function: __x64_sys_open+0x11e/0x150 fs/open.c:1456
Function: do_syscall_x64 arch/x86/entry/syscall_64.c:63 [inline]
Function: do_syscall_64+0xd2/0x200 arch/x86/entry/syscall_64.c:94
Function: entry_SYSCALL_64_after_hwframe+0x77/0x7f
Function: 0x0
============OTHER_INFO============
VarName 1320040775806694287, BlockLineNumber 43, IrLineNumber 1, watchpoint index 25359
Function: set_report_info+0xa6/0x200 kernel/kccwf/report.c:54
Function: setup_watchpoint kernel/kccwf/wp_checker.c:329 [inline]
Function: watchpoints_monitor+0xda8/0x1a10 kernel/kccwf/wp_checker.c:395
Function: handle_monitor_mode+0xca/0xf0 kernel/kccwf/core.c:193
Function: kccwf_rec_mem_access+0x391/0x410 kernel/kccwf/core.c:530
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
Function: btrfs_set_root_last_trans fs/btrfs/ctree.h:374 [inline]
Function: record_root_in_trans+0x806/0xab0 fs/btrfs/transaction.c:437
Function: btrfs_record_root_in_trans+0x3d9/0x4b0 fs/btrfs/transaction.c:504
Function: start_transaction+0x8dc/0x38a0 fs/btrfs/transaction.c:779
Function: btrfs_join_transaction+0x42/0x60 fs/btrfs/transaction.c:830
Function: btrfs_ioctl_qgroup_limit+0x32c/0x6c0 fs/btrfs/ioctl.c:3890
Function: btrfs_ioctl+0xb6e/0x1080 fs/btrfs/ioctl.c:5329
Function: vfs_ioctl fs/ioctl.c:51 [inline]
Function: __do_sys_ioctl fs/ioctl.c:907 [inline]
Function: __se_sys_ioctl+0xfc/0x170 fs/ioctl.c:893
Function: do_syscall_x64 arch/x86/entry/syscall_64.c:63 [inline]
Function: do_syscall_64+0xd2/0x200 arch/x86/entry/syscall_64.c:94
Function: entry_SYSCALL_64_after_hwframe+0x77/0x7f
=================END==============
------------[ cut here ]------------
kernel BUG at fs/buffer.c:1320!
Oops: invalid opcode: 0000 [#1] SMP KASAN NOPTI
CPU: 0 UID: 0 PID: 8618 Comm: syz-executor.3 Tainted: G    B               6.16.0-rc1-g836c2326e999-dirty #41 PREEMPT(voluntary) 
Tainted: [B]=BAD_PAGE
Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
RIP: 0010:check_irqs_on fs/buffer.c:1320 [inline]
RIP: 0010:lookup_bh_lru fs/buffer.c:1372 [inline]
RIP: 0010:find_get_block_common+0xf32/0x1070 fs/buffer.c:1410
Code: 84 24 a0 00 00 00 75 17 48 89 d8 48 8d 65 d8 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc cc e8 84 a2 17 04 e8 bf 78 b8 ff 90 <0f> 0b e8 b7 78 b8 ff 90 0f 0b 44 89 f9 80 e1 07 80 c1 03 38 c1 0f
RSP: 0018:ffff8881124ee160 EFLAGS: 00010093
RAX: ffffffffa0da3a31 RBX: 0000000000001000 RCX: ffff88813b320f40
RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
RBP: ffff8881124ee260 R08: ffff88810c6fa023 R09: 1ffff110218df404
R10: dffffc0000000000 R11: ffffed10218df405 R12: 1ffff1102249dc34
R13: 0000000000202021 R14: 0000000000000000 R15: ffff8881006a8000
FS:  00007f789798f6c0(0000) GS:ffff88824e78d000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f789794dd58 CR3: 000000012d736000 CR4: 00000000000006f0
Call Trace:
 <TASK>
 __find_get_block_nonatomic fs/buffer.c:1435 [inline]
 bdev_getblk+0x83/0x520 fs/buffer.c:1459
 getblk_unmovable include/linux/buffer_head.h:371 [inline]
 ext4_getblk+0x2a7/0x770 fs/ext4/inode.c:975
 ext4_bread_batch+0x65/0x4d0 fs/ext4/inode.c:1044
 __ext4_find_entry+0x1022/0x1f00 fs/ext4/namei.c:1601
 ext4_lookup_entry fs/ext4/namei.c:1703 [inline]
 ext4_lookup+0x137/0x640 fs/ext4/namei.c:1771
 lookup_open fs/namei.c:3686 [inline]
 open_last_lookups fs/namei.c:3807 [inline]
 path_openat+0x12f7/0x37d0 fs/namei.c:4043
 do_filp_open+0x1fd/0x470 fs/namei.c:4073
 file_open_name fs/open.c:1381 [inline]
 filp_open+0x176/0x1d0 fs/open.c:1401
 kccwf_save_reported_to_file+0x8e/0x2b0 kernel/kccwf/report.c:117
 report_race+0x6d4/0x770 kernel/kccwf/report.c:106
 found_watchpoint kernel/kccwf/wp_checker.c:298 [inline]
 watchpoints_monitor+0x13cd/0x1a10 kernel/kccwf/wp_checker.c:406
 handle_monitor_mode+0xca/0xf0 kernel/kccwf/core.c:193
 kccwf_rec_mem_access+0x391/0x410 kernel/kccwf/core.c:530
 btrfs_get_root_last_trans fs/btrfs/ctree.h:369 [inline]
 btrfs_record_root_in_trans+0x228/0x4b0 fs/btrfs/transaction.c:499
 start_transaction+0x8dc/0x38a0 fs/btrfs/transaction.c:779
 btrfs_start_transaction+0x49/0x70 fs/btrfs/transaction.c:816
 btrfs_truncate fs/btrfs/inode.c:7662 [inline]
 btrfs_setsize fs/btrfs/inode.c:5257 [inline]
 btrfs_setattr+0x11f5/0x2ae0 fs/btrfs/inode.c:5292
 notify_change+0xb2e/0xe30 fs/attr.c:552
 do_truncate+0x1a4/0x220 fs/open.c:68
 handle_truncate fs/namei.c:3508 [inline]
 do_open fs/namei.c:3891 [inline]
 path_openat+0x3043/0x37d0 fs/namei.c:4046
 do_filp_open+0x1fd/0x470 fs/namei.c:4073
 do_sys_openat2+0x121/0x1c0 fs/open.c:1437
 do_sys_open fs/open.c:1452 [inline]
 __do_sys_open fs/open.c:1460 [inline]
 __se_sys_open fs/open.c:1456 [inline]
 __x64_sys_open+0x11e/0x150 fs/open.c:1456
 do_syscall_x64 arch/x86/entry/syscall_64.c:63 [inline]
 do_syscall_64+0xd2/0x200 arch/x86/entry/syscall_64.c:94
 entry_SYSCALL_64_after_hwframe+0x77/0x7f
RIP: 0033:0x7f78985fc59d
Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 b8 ff ff ff f7 d8 64 89 01 48
RSP: 002b:00007f789798f088 EFLAGS: 00000246 ORIG_RAX: 0000000000000002
RAX: ffffffffffffffda RBX: 00007f789874bf80 RCX: 00007f78985fc59d
RDX: 0000000000000000 RSI: 0000000000121200 RDI: 0000000020005140
RBP: 00007f789866d4de R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
R13: ffffffffffffffb8 R14: 00007f789874bf80 R15: 00007fffc74ab250
 </TASK>
Modules linked in:
---[ end trace 0000000000000000 ]---
RIP: 0010:check_irqs_on fs/buffer.c:1320 [inline]
RIP: 0010:lookup_bh_lru fs/buffer.c:1372 [inline]
RIP: 0010:find_get_block_common+0xf32/0x1070 fs/buffer.c:1410
Code: 84 24 a0 00 00 00 75 17 48 89 d8 48 8d 65 d8 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc cc e8 84 a2 17 04 e8 bf 78 b8 ff 90 <0f> 0b e8 b7 78 b8 ff 90 0f 0b 44 89 f9 80 e1 07 80 c1 03 38 c1 0f
RSP: 0018:ffff8881124ee160 EFLAGS: 00010093
RAX: ffffffffa0da3a31 RBX: 0000000000001000 RCX: ffff88813b320f40
RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
RBP: ffff8881124ee260 R08: ffff88810c6fa023 R09: 1ffff110218df404
R10: dffffc0000000000 R11: ffffed10218df405 R12: 1ffff1102249dc34
R13: 0000000000202021 R14: 0000000000000000 R15: ffff8881006a8000
FS:  00007f789798f6c0(0000) GS:ffff88824e78d000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f789794dd58 CR3: 000000012d736000 CR4: 00000000000006f0
note: syz-executor.3[8618] exited with irqs disabled
BTRFS warning (device sdb): can't clear the compat_ro:1,block_group_tree,compat_ro:5,compat_ro:8,compat_ro:15,compat_ro:16,compat_ro:17,compat_ro:18,compat_ro:19,compat_ro:20,compat_ro:21,compat_ro:22,compat_ro:24,compat_ro:25,compat_ro:26,compat_ro:29,compat_ro:33,compat_ro:34,compat_ro:35,compat_ro:39,compat_ro:43,compat_ro:45,compat_ro:47,compat_ro:49,compat_ro:53,compat_ro:55,compat_ro:56,compat_ro:57,compat_ro:58,compat_ro:59,compat_ro:61,compat_ro:62 feature bits while mounted
