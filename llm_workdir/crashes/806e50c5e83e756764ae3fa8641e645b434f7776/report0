BTRFS warning (device sdb): can't clear the compat:0 feature bit while mounted
var addr ffff88810d1cc300, addr masked 88810d1cc300
Kernel panic: ============ DATARACE ============
VarName 1320040775806694287, BlockLineNumber 43, IrLineNumber 1, is write 1
Function: found_watchpoint kernel/kccwf/wp_checker.c:298 [inline]
Function: watchpoints_monitor+0x15f5/0x1b00 kernel/kccwf/wp_checker.c:394
Function: kccwf_rec_mem_access+0x7d2/0x940
Function: btrfs_set_root_last_trans fs/btrfs/ctree.h:374 [inline]
Function: record_root_in_trans+0x806/0xab0 fs/btrfs/transaction.c:437
Function: btrfs_record_root_in_trans+0x3d9/0x4b0 fs/btrfs/transaction.c:504
Function: start_transaction+0x8dc/0x38a0 fs/btrfs/transaction.c:779
Function: btrfs_start_transaction+0x49/0x70 fs/btrfs/transaction.c:816
Function: btrfs_truncate fs/btrfs/inode.c:7662 [inline]
Function: btrfs_setsize fs/btrfs/inode.c:5257 [inline]
Function: btrfs_setattr+0x11f5/0x2ae0 fs/btrfs/inode.c:5292
Function: notify_change+0xb2e/0xe30 fs/attr.c:552
Function: do_truncate+0x1a4/0x220 fs/open.c:68
Function: handle_truncate fs/namei.c:3508 [inline]
Function: do_open fs/namei.c:3891 [inline]
Function: path_openat+0x3043/0x37d0 fs/namei.c:4046
Function: do_filp_open+0x1fd/0x470 fs/namei.c:4073
Function: do_sys_openat2+0x121/0x1c0 fs/open.c:1437
Function: do_sys_open fs/open.c:1452 [inline]
Function: __do_sys_open fs/open.c:1460 [inline]
Function: __se_sys_open fs/open.c:1456 [inline]
Function: __x64_sys_open+0x11e/0x150 fs/open.c:1456
Function: do_syscall_x64 arch/x86/entry/syscall_64.c:63 [inline]
Function: do_syscall_64+0xd2/0x200 arch/x86/entry/syscall_64.c:94
Function: entry_SYSCALL_64_after_hwframe+0x77/0x7f
Function: 0x0
============OTHER_INFO============
VarName 2870364362311847012, BlockLineNumber 9, IrLineNumber 1, watchpoint index 37647
Function: set_report_info+0xa6/0x200 kernel/kccwf/report.c:54
Function: setup_watchpoint kernel/kccwf/wp_checker.c:329 [inline]
Function: watchpoints_monitor+0x9a9/0x1b00 kernel/kccwf/wp_checker.c:414
Function: kccwf_rec_mem_access+0x7d2/0x940
Function: btrfs_get_root_last_trans fs/btrfs/ctree.h:369 [inline]
Function: btrfs_record_root_in_trans+0x228/0x4b0 fs/btrfs/transaction.c:499
Function: start_transaction+0x8dc/0x38a0 fs/btrfs/transaction.c:779
Function: btrfs_join_transaction+0x42/0x60 fs/btrfs/transaction.c:830
Function: btrfs_ioctl_qgroup_assign+0x4c6/0x970 fs/btrfs/ioctl.c:3769
Function: btrfs_ioctl+0x7ea/0x1080 fs/btrfs/ioctl.c:5325
Function: vfs_ioctl fs/ioctl.c:51 [inline]
Function: __do_sys_ioctl fs/ioctl.c:907 [inline]
Function: __se_sys_ioctl+0xfc/0x170 fs/ioctl.c:893
Function: do_syscall_x64 arch/x86/entry/syscall_64.c:63 [inline]
Function: do_syscall_64+0xd2/0x200 arch/x86/entry/syscall_64.c:94
Function: entry_SYSCALL_64_after_hwframe+0x77/0x7f
=================END==============
------------[ cut here ]------------
kernel BUG at fs/buffer.c:1320!
Oops: invalid opcode: 0000 [#1] SMP KASAN NOPTI
CPU: 1 UID: 0 PID: 10041 Comm: syz-executor.5 Tainted: G    B               6.16.0-rc1-g836c2326e999-dirty #40 PREEMPT(voluntary) 
Tainted: [B]=BAD_PAGE
Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
RIP: 0010:check_irqs_on fs/buffer.c:1320 [inline]
RIP: 0010:lookup_bh_lru fs/buffer.c:1372 [inline]
RIP: 0010:find_get_block_common+0xf32/0x1070 fs/buffer.c:1410
Code: 84 24 a0 00 00 00 75 17 48 89 d8 48 8d 65 d8 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc cc e8 94 9e 17 04 e8 bf 78 b8 ff 90 <0f> 0b e8 b7 78 b8 ff 90 0f 0b 44 89 f9 80 e1 07 80 c1 03 38 c1 0f
RSP: 0018:ffff888117695a40 EFLAGS: 00010086
RAX: ffffffff81ba2e21 RBX: 0000000000001000 RCX: 0000000008600000
RDX: ffffc9000c371000 RSI: 000000000000e242 RDI: 000000000000e243
RBP: ffff888117695b40 R08: ffff8881006efa63 R09: 1ffff110200ddf4c
R10: dffffc0000000000 R11: ffffed10200ddf4d R12: 1ffff11022ed2b50
R13: 0000000000202021 R14: 0000000000000000 R15: ffff8881006e0000
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
FS:  00007f5ec60af6c0(0000) GS:ffff888259e0d000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007ffdda11dcd0 CR3: 00000001414ef000 CR4: 00000000000006f0
Call Trace:
 <TASK>
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): get dev_stats failed, device not found
 __find_get_block_nonatomic fs/buffer.c:1435 [inline]
 bdev_getblk+0x83/0x520 fs/buffer.c:1459
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): can't clear the compat:0 feature bit while mounted
 getblk_unmovable include/linux/buffer_head.h:371 [inline]
 ext4_getblk+0x2a7/0x770 fs/ext4/inode.c:975
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
 ext4_bread_batch+0x65/0x4d0 fs/ext4/inode.c:1044
 __ext4_find_entry+0x1022/0x1f00 fs/ext4/namei.c:1601
 ext4_lookup_entry fs/ext4/namei.c:1703 [inline]
 ext4_lookup+0x137/0x640 fs/ext4/namei.c:1771
 lookup_open fs/namei.c:3686 [inline]
 open_last_lookups fs/namei.c:3807 [inline]
 path_openat+0x12f7/0x37d0 fs/namei.c:4043
 do_filp_open+0x1fd/0x470 fs/namei.c:4073
 file_open_name fs/open.c:1381 [inline]
 filp_open+0x176/0x1d0 fs/open.c:1401
 kccwf_save_reported_to_file+0x8e/0x2b0 kernel/kccwf/report.c:117
 report_race+0x6d4/0x770 kernel/kccwf/report.c:106
 found_watchpoint kernel/kccwf/wp_checker.c:298 [inline]
 watchpoints_monitor+0x15f5/0x1b00 kernel/kccwf/wp_checker.c:394
 kccwf_rec_mem_access+0x7d2/0x940
BTRFS info (device sdb): qgroup scan completed (inconsistency flag cleared)
 btrfs_set_root_last_trans fs/btrfs/ctree.h:374 [inline]
 record_root_in_trans+0x806/0xab0 fs/btrfs/transaction.c:437
 btrfs_record_root_in_trans+0x3d9/0x4b0 fs/btrfs/transaction.c:504
 start_transaction+0x8dc/0x38a0 fs/btrfs/transaction.c:779
 btrfs_start_transaction+0x49/0x70 fs/btrfs/transaction.c:816
 btrfs_truncate fs/btrfs/inode.c:7662 [inline]
 btrfs_setsize fs/btrfs/inode.c:5257 [inline]
 btrfs_setattr+0x11f5/0x2ae0 fs/btrfs/inode.c:5292
 notify_change+0xb2e/0xe30 fs/attr.c:552
 do_truncate+0x1a4/0x220 fs/open.c:68
 handle_truncate fs/namei.c:3508 [inline]
 do_open fs/namei.c:3891 [inline]
 path_openat+0x3043/0x37d0 fs/namei.c:4046
 do_filp_open+0x1fd/0x470 fs/namei.c:4073
 do_sys_openat2+0x121/0x1c0 fs/open.c:1437
 do_sys_open fs/open.c:1452 [inline]
 __do_sys_open fs/open.c:1460 [inline]
 __se_sys_open fs/open.c:1456 [inline]
 __x64_sys_open+0x11e/0x150 fs/open.c:1456
 do_syscall_x64 arch/x86/entry/syscall_64.c:63 [inline]
 do_syscall_64+0xd2/0x200 arch/x86/entry/syscall_64.c:94
 entry_SYSCALL_64_after_hwframe+0x77/0x7f
RIP: 0033:0x7f5ec6d1935d
Code: ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 b8 ff ff ff f7 d8 64 89 01 48
RSP: 002b:00007f5ec60af0a8 EFLAGS: 00000246 ORIG_RAX: 0000000000000002
RAX: ffffffffffffffda RBX: 00007f5ec6e6bf80 RCX: 00007f5ec6d1935d
RDX: 0000000000000004 RSI: 0000000000020600 RDI: 0000000020003840
RBP: 00007f5ec6d8a4b1 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
R13: ffffffffffffffb8 R14: 00007f5ec6e6bf80 R15: 00007ffccf4162c0
 </TASK>
Modules linked in:
---[ end trace 0000000000000000 ]---
RIP: 0010:check_irqs_on fs/buffer.c:1320 [inline]
RIP: 0010:lookup_bh_lru fs/buffer.c:1372 [inline]
RIP: 0010:find_get_block_common+0xf32/0x1070 fs/buffer.c:1410
Code: 84 24 a0 00 00 00 75 17 48 89 d8 48 8d 65 d8 5b 41 5c 41 5d 41 5e 41 5f 5d c3 cc cc cc cc cc e8 94 9e 17 04 e8 bf 78 b8 ff 90 <0f> 0b e8 b7 78 b8 ff 90 0f 0b 44 89 f9 80 e1 07 80 c1 03 38 c1 0f
RSP: 0018:ffff888117695a40 EFLAGS: 00010086
RAX: ffffffff81ba2e21 RBX: 0000000000001000 RCX: 0000000008600000
RDX: ffffc9000c371000 RSI: 000000000000e242 RDI: 000000000000e243
RBP: ffff888117695b40 R08: ffff8881006efa63 R09: 1ffff110200ddf4c
R10: dffffc0000000000 R11: ffffed10200ddf4d R12: 1ffff11022ed2b50
R13: 0000000000202021 R14: 0000000000000000 R15: ffff8881006e0000
FS:  00007f5ec60af6c0(0000) GS:ffff888259e0d000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007ffdda11dcd0 CR3: 00000001414ef000 CR4: 00000000000006f0
note: syz-executor.5[10041] exited with irqs disabled
BTRFS warning (device sdb): can't clear the compat:0 feature bit while mounted
BTRFS warning (device sdb): get dev_stats failed, device not found
BTRFS warning (device sdb): can't clear the compat:0 feature bit while mounted
BTRFS warning (device sdb): can't clear the compat:0 feature bit while mounted
BTRFS warning (device sdb): can't clear the compat:0 feature bit while mounted
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): get dev_stats failed, device not found
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): can't clear the compat:0,compat:1 feature bits while mounted
BTRFS warning (device sdb): get dev_stats failed, device not found
